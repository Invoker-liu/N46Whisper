# 技术设计：TTS 框架集成

## 上下文
N46Whisper 是基于 Google Colab 的字幕生成工具，现需扩展 TTS 功能。需在 Colab 免费版环境（T4 GPU、12GB RAM）中运行，优先选择开源无付费 API 方案。

## 目标 / 非目标
**目标：**
- 集成高质量开源 TTS 框架
- 支持中文和日语
- 在 Colab 环境中流畅运行
- 保持与现有界面一致性

**非目标：**
- 声音克隆功能（首版不含）
- 实时流式输出
- 自训练模型

## TTS 框架对比

| 框架 | 中文支持 | 语音质量 | 推理速度 | 内存占用 | 许可证 |
|------|---------|---------|---------|---------|--------|
| Coqui TTS | ✅ | 高 | 中等 | 中 | MPL-2.0 |
| Bark | ✅ | 极高 | 慢 | 高(8GB+) | MIT |
| VITS/VITS2 | ✅ | 高 | 快 | 低 | MIT |
| Piper TTS | ✅ | 中高 | 极快 | 极低 | MIT |
| Tortoise TTS | ❌ 有限 | 极高 | 极慢 | 高 | Apache-2.0 |

## 决策
**推荐方案：VITS/VITS2 + Piper TTS 双轨**

理由：
1. **VITS** 作为主力：语音质量高、中文支持好、推理速度快
2. **Piper TTS** 作为轻量备选：适合长文本、资源受限场景

考虑的替代方案：
- Bark：质量最高但推理过慢，Colab 会话可能超时
- Tortoise：英文质量极佳但中文支持差

## 风险 / 权衡
- **风险**：模型下载可能较慢 → 缓存到 Google Drive
- **风险**：长文本处理可能 OOM → 分段处理 + 内存管理
- **权衡**：质量 vs 速度 → 提供多模型选项让用户自选

## 架构设计

```
用户输入 (.txt/.srt)
    ↓
文本预处理（分段、标点规范化）
    ↓
TTS 模型选择（VITS/Piper）
    ↓
GPU 加速推理
    ↓
音频片段合并
    ↓
输出 (.mp3/.wav)
```

## 待决问题
- [ ] 确认 VITS 中文预训练模型的具体版本
- [ ] 确认日语支持的模型选项
- [ ] 是否需要支持字幕时间轴同步的配音功能
